\chapter{Détection des anomalies dans les délais d'un lien}
Dans le présent chapitre, nous présentons l'outil de détection des anomalies dans les délais d'un lien. Cet outil a été  conçu dans le cadre du travail \cite{DBLP:journals/corr/FontugneAPB16}  de  Fontugne et al.. Nous avons choisi de réutiliser ce travail qui se base sur les traceroutes collectés par les sondes, et ce en vue d'évaluer son implémentation avec quelques technologies  Big Data.  

\section{Présentation générale}

Dans leur travail \cite{DBLP:journals/corr/FontugneAPB16}, Fontugne et al. ont exploité la grande répartition  des sondes  dans le monde afin d'étudier le délai des liens topologiques sur les réseaux informatiques et de tracer son évolution; c'est le délai entre deux routeurs adjacents sur Internet.

L'idée de ce travail est de collecter les résultats des requêtes traceroute effectuées par les sondes, d'en déterminer une valeur de référence du délai du lien en question sur base de  son historique, et ensuite de comparer la référence avec la valeur courante.  Cette référence est mise à jour au fur et au mesure de l'analyse de nouveaux traceroutes. 
La comparaison de la référence avec la valeur courante ne se déclenche que lorsque cette  référence est assez représentable de l'état réel\footnote{Avec une probabilité de $95\%$.} du lien.

Le travail \cite{DBLP:journals/corr/FontugneAPB16} de  Fontugne et al.  comprend trois méthodes. Nous allons travailler sur la méthode ayant pour objectif la détection des changements des délais que subissent les liens intermédiaires dans les traceroutes.

\section{Pourquoi analyser les délais des liens  ?}

%Il existe un bon nombre de sujets à traiter en exploitant les données collectées par les sondes Atlas. Quelques exemples de sujets ont été déjà présentés dans la section \ref{use-cases-atlas}. Notre choix de reprendre le travail de Fontugne et al. \cite{DBLP:journals/corr/FontugneAPB16} a été fait après avoir parcouru un ensemble de travaux basés sur le projet  RIPE Atlas. 

Pour certains travaux, il n'était pas possible  de les reprendre suite au manque de détails et de l'accès à  certaines ressources réseaux utilisées dans ces travaux \footnote{Par exemple, les informations du peering entre les Systèmes Autonomes, la géolocalisation des adresses IP, etc.}. Par exemple, afin d'étudier la censure dans un pays donné, il faut être au courant des spécificités de ce pays, les circonstances politiques et sociales, les opposants,  etc.  Un autre exemple concerne le sujet de la détection des détours du trafic local dans un pays.  Anant Shah  et al. ont travaillé sur la détection des détours, ils ont présenté dans  \cite{anant-shah} les contraintes relatives à ce sujet: la difficulté d'avoir une géolocalisation exacte d'une adresse IP d'une part et l'absence des informations de peering entre les ASs d'autre part. Ces dernières peuvent changer complètement les conclusions finales. 

Le travail sur lequel nous nous basons \cite{DBLP:journals/corr/FontugneAPB16} pour l'évaluation de quelques technologies Big Data s'inscrit dans les travaux traitant les performances des réseaux informatiques. Dans la suite de ce document, ce travail est appelé  travail de référence.  Ce travail a été choisi comme référence pour plusieurs raisons:



\paragraph{Les données utilisées}  Les auteurs de ce travail ont exploité des données déjà présentes dans le dépôt d'Atlas (voir la section \ref{subsec:sources-data} concernant les sources de données Atlas). Ainsi, il n'y a pas besoin de lancer des mesures qui nécessitent la possession d'assez de crédits (voir la section sur les crédits d'Atlas dans \ref{credits-atlas}). De plus, les mesures intégrées montrent plus de stabilité par rapport aux mesures personnalisées. Les destinations des mesures intégrées sont prédéfinies, généralement ce sont des instances des serveurs DNS et des serveurs gérés par  RIPE NCC. Alors que, les mesures personnalisées peuvent concerner des destinations moins stables en terme de disponibilité.

\paragraph{La clarté du travail} La communauté  Atlas est active en nombre de travaux publiés.   Certains de ces travaux reprennent seulement les résultats finaux. Pour d'autres,  la méthodologie est bien détaillée. Le reste des travaux reprennent brièvement la méthodologie adoptée. En ce qui concerne le  travail choisi, la méthodologie est bien détaillée.

\paragraph{La disponibilité du code source} La détection des anomalies proposée a été mise en pratique à travers un outil. Le code source de cet outil est disponible sur GitHub \cite{InternetHealthReport}. L'accès au code source de l'outil nous a permis de bien comprendre le processus de détection.

%Avoir le code source disponible sur GitHub est avantageux. L'objectif n'était pas de réécrire ce que les auteurs ont fait, mais plutôt le comprendre et éventuellement l'ajuster suivant les besoins.  De plus, l'onglet \textit{issues} du projet permet de  demander des détails aux contributeurs mais aussi cela permet de partager les réflexions.

\paragraph{La possibilité de la validation des résultats}  Comme il est cité dans le travail \cite{DBLP:journals/corr/FontugneAPB16}, les auteurs ont démontré la cohérence de l'outil de détection avec des événements réels comme les  attaques DDOS.
\begin{tcolorbox}
	Une attaque de type Distributed Denial of Service (\textbf{\textit{DDOS}}) vise la disponibilité d'un serveur en surchargeant ce dernier avec un trafic depuis différentes sources, d'où le terme \textit{Distributed}.
\end{tcolorbox}


%\section{Etude des délais des liens } \label{outil-detection-details}

\section{Les données utilisées dans l'analyse des délais}
La méthode conçue pour la détection des changements des délais se base sur des fondements statistiques. Ces derniers sont capables de montrer leurs performances si la taille des échantillons\footnote{C'est l'ensemble des RTTs différentiels caractérisant un lien.} sur lesquels ils se basent est grande.   Afin de surveiller un grand nombre de liens sur Internet, il faut avoir un grand nombre de sondes avec une certaine diversité.  En ce qui concerne le travail de référence, les auteurs ont utilisé des traceroutes en provenance des mesures intégrées et des traceroutes à destination des ancres.
Le Tableau \ref{tab:dataset} fournit plus de détails sur les traceroutes utilisés : le nombre de traceroutes est donné suivant leur type d'adressage (IPv4 et IPv6) et les sondes ayant été impliquées dans ces derniers.
%leur adressage le nombre de traceroutes ainsi que le nombre de sondes impliquées dans ces traceroutes, et ce pour les deux types d'adressages.  
Ces chiffres correspondent à la période du $1$ mai au 31 décembre $2015$.
\begin{table}[H]
	\centering
	\begin{tabular}{c c c}
		\hline
		& \textbf{Nombre de traceroutes (milliards)}& \textbf{Nombre de sondes}\\ \hline
		IPv4		&$ 2.8 $  & $ 11,538 $\\ \hline
		IPv6	&	$ 1.2 $  & $ 4,307 $ \\ \hline
	\end{tabular}
	\caption{Récapitulatif des traceroutes utilisés dans le travail de référence }
	\label{tab:dataset}
\end{table}

%\subsection{Description détaillée de la détection des anomalies dans les délais}
\section{Le principe de détection des changements des délais} \label{principe-de-detection}

Le processus de  détection des anomalies dans les délais d'un lien repose sur une métrique caractérisant un lien dans un réseau informatique : le RTT différentiel.

Définissons d'abord le  RTT (Round-Trip Time) :
%Il est indispensable de présenter la définition du RTT  (Round Trip Time)  différentiel d'un lien avant de procéder à la description de l'algorithme de la détection des anomalies. 
\begin{tcolorbox}
	%\textbf{ICMP}  est un protocole utilisé pour véhiculer des messages de contrôle sur Internet.
	\textbf{RTT} est obtenu en calculant la différence entre le timestamp associé à l'envoi du paquet vers une destination  et le timestamp associé à la réception de la réponse ICMP (Internet Control Message Protocol) de cette destination. C'est une métrique utilisée pour évaluer les performances d'un réseau en matière de temps de réponse. 
\end{tcolorbox}
Les mesures du RTT sont fournies par les utilitaires traceroute et ping. En ce qui concerne traceroute,  il fournit les sauts (routeurs intermédiaires) impliqués dans le  chemin de forwarding avec leurs RTTs, c'est le chemin parcouru par le trafic entre la source et la destination. On note qu'un  RTT inclut le temps de transmission, du queuing et  du traitement. 

\paragraph{Définition du RTT différentiel d'un lien }~

La Figure 	\ref{fig:rtt-differ} (a)  illustre le RTT entre la sonde P et deux routeurs B et C. Le RTT différentiel  du lien entre  $B$ et $C$ adjacents, noté $\Delta_{PBC}$, est la différence du RTT entre la sonde $P$ et $B$ (bleu) d'une part, et du RTT entre la sonde $P$ et $C$  (rouge) d'autre part, comme   illustré dans la Figure	\ref{fig:rtt-differ} (b). 

\begin{figure}[h]
	\centering
	\captionsetup{justification= centering}
	\includegraphics[width=0.7\linewidth]{illustrations/rtt-differ}
	\caption{(a) Le RTT entre la sonde P et les routeurs B et C. (b) La différence entre les  chemins de retour depuis les routeurs B et C vers la sonde P. Source : \cite{DBLP:journals/corr/FontugneAPB16}}
	\label{fig:rtt-differ}
\end{figure} 
Le RTT différentiel $ \Delta_{PBC} $ de la Figure 	\ref{fig:rtt-differ} (b) est décomposé comme suit :
\begin{align}
RTT_{PB} & =  \delta_{PA} + \delta_{AB} + \delta_{BA} + \delta_{AP} \nonumber\\
RTT_{PC} & = \delta_{PA} + \delta_{AB} + \delta_{BC} + \delta_{CD} + \delta_{DA}+ \delta_{AP} \nonumber\\
\Delta_{PBC} & = RTT_{PC} - RTT_{PB}  \label{eq:rttdifference}\\ 
& =  \delta_{BC} + \delta_{CD} + \delta_{DA}- \delta_{BA} \nonumber \\
& = \delta_{BC} + \varepsilon_{PBC} \label{eq:rttdiff}
\end{align}

où $\delta_{BC}$ est le délai du lien $BC$ et $\varepsilon_{PBC}$ est la différence entre les deux chemins de retour : $B$ vers $P$ et $C$ vers $P$.  Le chemin de retour est celui  présenté dans  la Figure \ref{fig:rtt-differ} (b). 
%La première composante dépend de l'état des routeurs $B$ et $C$. La deuxième composante dépend de la sonde $P$. L'analyse du RTT différentiel repose sur la variation de valeurs qu'il prend, au lieu des valeurs exactes, dans  le cas des valeurs exactes, elles peuvent dévier l'interprétation.


\paragraph{Le principe de la détection des changements des délais}~

L'évolution du délai d'un lien est déduit de l'évolution de son RTT différentiel. Reprenons d'abord l'équation (\ref{eq:rttdiff}) du RTT différentiel du lien BC. Les deux variables $\delta_{BC}$ et $\varepsilon_{PBC}$ sont affectées par des facteurs différents.
La valeur de  $\delta_{BC}$ dépend de l'état des deux routeurs B et C et ne dépend pas de la sonde P. Tandis que la valeur de $\varepsilon_{PBC}$ dépend de la sonde P.

Supposons qu'on dispose d'un nombre $n$ de sondes Atlas P$_i$, $i$ $\in$ [$1$, $n$], telles que toutes les sondes ont un chemin de retour  $\varepsilon_{P_{i}BC}$ différent depuis B et depuis C.  Les $n$ RTTs différentiels $\Delta_{P{_i}BC}$ du lien $BC$ pour chacune des sondes $P_i$  partagent la même composante $\delta_{BC}$ :


\begin{align*}
\Delta_{P_{1}BC} &= \delta_{BC} + \varepsilon_{P_{1}BC}\\
\Delta_{P_{2}BC} &= \delta_{BC} + \varepsilon_{P_{2}BC}\\
.... &   ... \\
\Delta_{P_{i}BC} &= \delta_{BC} + \varepsilon_{P_{i}BC}\\
\Delta_{P_{n}BC} &= \delta_{BC} + \varepsilon_{P_{n}BC}\\
\end{align*}

Les valeurs de  $\varepsilon_{P_{i}BC}$ sont  indépendantes. L'indépendance de ces valeurs implique que la distribution $\Delta_{P_{i}BC}$ est estimé  stable au cours du temps si $\delta_{BC}$ est constant. Toutefois, un changement significatif de la valeur de $\delta_{BC}$ influence les valeurs des RTTs différentiels, ainsi,  la distribution des RTTs différentiels $\Delta_{P_{i}BC}$ change. D'où l'idée de l'évolution du délai d'un lien déduit  à partir de l'évolution de son RTT différentiel.

\paragraph{Caractérisation des délais d'un lien}~

Les auteurs du travail de référence \cite{DBLP:journals/corr/FontugneAPB16} ont évalué le délai d'un lien en évaluant son RTT différentiel. Cette évaluation repose sur le théorème central limite énoncé ci-dessous\footnote{Voir le théorème  $ 4.11.1 $ dans \cite{lefebvre2003cours}.}.

\begin{tcolorbox}
	Soient $X_1$, ..., $X_n$ $n$ variables aléatoires \textit{i.i.d}. de moyenne $\mu$ et variance $\sigma^2$ finies ($\sigma > 0$). Soient $S_n$ la somme des $n$ variables aléatoires et 
	\begin{equation}
	Z_n := \frac{S_n - n\mu}{\sqrt{n} \sigma}.
	\end{equation} 
	Alors la fonction de répartition de $Z_n$ tend vers celle d'une loi $N(0,1)$ lorsque $n$ tend vers l'infini.
	
	Remarque : on peut aussi écrire le résultat suivant :
	\begin{equation}
	Sn \approx N(n\mu, n\sigma^2)
	\end{equation}
\end{tcolorbox}

L'application de ce théorème, dans  l'analyse des délais des liens, implique que quelque soit la distribution des RTTs différentiels, la moyenne arithmétique d'un échantillon  est distribuée normalement si la taille de l'échantillon est relativement grande. En pratique,
si un lien subit un changement anormal, la distribution de la moyenne des RTTs différentiels dévie de la distribution normale, par conséquent, la moyenne des RTTs différentiels ayant produit ce changement est identifiée comme  étant une anomalie.

Après avoir évalué les premiers résultats d'application de ce théorème, les auteurs ont conclu que l'utilisation de la médiane,  au lieu de la moyenne, a montré plus de performance en terme de détection des anomalies.
Afin de tenir compte de l'incertitude dans la médiane calculée, ayant la capacité d'identifier un changement anormal, les auteurs ont  calculé  l'intervalle de confiance de cette dernière.
%La distribution des médianes des RTTs différentiels caractérisant un lien est mise à jour tout au long de l'analyse des différentes périodes. 
Par définition\footnote{Definition 2.1 dans \cite{leboudec2010performance}.},  un intervalle de confiance à un niveau $\gamma$,  d'un paramètre $m$ fixé mais inconnu est l'intervalle  $(u(X_1,...,X_n),v(X_1,...,X_n)) $ tel que  :

\begin{align}
\mathbb{P}(u(X_1,...,X_n)< m< v(X_1,...,X_n)) \geq \gamma
\end{align}

\section{L'étude des délais des liens en pratique : l'évolution du RTT différentiel des liens}

L'évolution des RTTs différentiels est une  application du principe décrit dans la section  \ref{principe-de-detection}. Pour un lien donné, le suivi s'étale sur plusieurs  périodes consécutives.  

\subsection{Les étapes principales de détection} \label{steps:detection}
Les étapes du processus de détection peuvent être résumées dans les éléments suivants:

\begin{enumerate}[label=(\roman*)]
	
	\item Vérification de la validité de tout traceroute.
	
	\item Calcul des RTTs différentiels de chaque lien identifié dans les traceroutes.
	
	\item Caractérisation des liens avec le théorème central limite (CLT).
	
	\item  Comparaison de l'état de chaque lien avec sa référence  et l'identification des anomalies.
	
	\item Mise à jour de la référence du lien.
\end{enumerate}

\subsection{Description des paramètres de l'analyse des délais} \label{par:parametre-de-lanalyse}~
La détection des changements des délais nécessite l'ajustement de quelques paramètres. Ces paramètres ont des valeurs par défaut  définies dans le travail de référence. Nous décrivons ci-dessous tous les paramètres : ceux ayant une valeur par défaut et ceux à ajuster :

\begin{description}
	\item[traceroutes] : ce sont l'ensemble des résultats de requêtes traceroute. La détection des anomalies est effectuée suivant le nombre de traceroutes analysés et la période précisée. 
	%Les  traceroutes sont obtenus en utilisant l'API fournie par Atlas.
	\item[start] : c'est la date de début de l'analyse. Seuls les traceroutes effectués par les sondes  à partir de cette date sont analysés.
	\item[end]  : c'est la date marquant la fin de l'analyse. Comme le paramètre \textit{start}, c'est la date maximales des  traceroutes à considérer effectués par les sondes.
	\item[timeWindow]:  ce paramètre est exprimé en secondes. Il correspond à la durée de chaque période des $n$ périodes de l'analyse. Ces périodes ont la même durée. Autrement dit, la durée entre   \textit{start} et \textit{end} est divisée par \textit{timeWindow}. Ceci est illustré à la Figure  \ref{fig:timing_tex_}. Avec $d_i$ dénote le début de la i\up{ème} période,  $i \in [1,n]$. Par défaut, \textit{timeWindow} vaut $ 3600 $ secondes. 
	%illustre le contexte des trois paramètres \textit{start}, \textit{end} et \textit{timeWindow} avec les étapes principales
	\begin{figure}[h]
		\centering
		\captionsetup{justification=centering}
		\input{illustrations/timing.tex}
		\caption{Illustration des périodes de l'analyse entre la date de début et la date de fin.}
		\label{fig:timing_tex_}
	\end{figure}
	%\begin{figure}[h]	
	%	\centering
	%	\resizebox{\textwidth}{!}{
	%		\input{dia/timewindow.tex} 
	%	}
	%	\caption{Illustration du paramètre timeWindow}
	%	\label{fig:timewindow}
	%\end{figure}
	\item[minSeen] : est le nombre de fenêtres à atteindre avant de commencer la comparaison du RTT différentiel d'un lien avec sa référence. 
	%comme l'analyse des liens est réalisée sur plusieurs périodes de durée \textit{timeWindow}, 
	%ce paramètre est un entier, il indique le déclenchement de la comparaison du RTT différentiel de référence d'un lien avec sa valeur courante.  
	%Par exemple, si $ minSeen = 24 $ et $timeWindow = 3600$ (1 heure), cela implique que la première référence de tout lien est construite des valeurs obtenues tout au long la durée $24 * timeWindow$, donc après avoir analysé les traceroutes d'une journée. A la 25\up{ème} \textit{timeWindow}, la détection des anomalies s'effectue.
	% nombre de fois à partir desquelles on peut  vérifier son RTT différentiel; s'il indique une anomalie ou non. 
	%Par exemple, un lien peut être identifié dans $3$ $d_i$, ou bien être identifié  une seule fois durant toute la période de l'analyse.
	
	\item[alpha ]: noté $\alpha$,  $\alpha \in [0, 1]$, c'est le paramètre de la  moyenne mobile exponentielle calculée.
	%\guillemotleft \textit{ Les méthodes de lissage exponentiel  sont un ensemble de techniques empiriques de prévision qui accordent plus ou moins d'importance aux valeurs du passé d'une série temporelle\footnote{Source : \url{https://perso.math.univ-toulouse.fr/lagnoux/files/2013/12/Chap6.pdf}, consultée le $30/09/2018.$}}. \guillemotright
	
	La  moyenne mobile exponentielle est utilisée pour calculer la moyenne des RTTs différentiels de référence durant une période $d_k$.
	% Cette médiane constitue une référence  sur laquelle se base la détection des anomalies.
	La  valeur de la médiane des RTTs différentiels de référence $ \overline{m}_{t}$   pour la période $ t $ et  le lien $l$ :
	\begin{align*}
	\overline{m}_{t} &=  \alpha{m}_{t} + (1 -  \alpha)  \overline{m}_{t-1}
	\end{align*} 
	$m_t$ la médiane des RTTs différentiels observée pour $l$ durant la \textit{période} $t$. 
	
	$ \overline{m}_{t-1}$  la médiane des  RTTs différentiels  de référence durant la \textit{période} $ t-1 $.  
	
	
	
	Pour précision, \{$m_t$\} et \{$ \overline{m}_{t}$\} désignent deux ensembles différents.   Le premier est l'ensemble des médianes des RTTs différentiels de chaque période $d_k$. Or, le deuxième est l'ensemble des médianes des RTTs différentiels, de référence, construite en utilisant la méthode de la moyenne mobile exponentielle. Le calcul de cette dernière prend en compte les médianes des RTTs différentiels précédentes ainsi que la médiane des RTTs différentiels courante. La participation de ces dernières dans le calcul de la référence est dirigé par le paramètre $\alpha$. Plus de détails sur ce calcul est donné dans la section[!]. 
	%La  valeur de la médiane de référence  $ \overline{m}_{t}$ de la période $t$ est obtenue par: 
	
	
	
	Le paramètre $\alpha$  contrôle l'importance  des mesures précédentes par rapport aux mesures récentes. De ce fait, \guillemotleft \textit{plus $\alpha$ est proche de $ 1 $ plus les observations récentes influent sur la prévision, à l'inverse un $\alpha$ proche de $0$ conduit à une prévision très stable prenant en compte un passé lointain}\footnote{Voir le Lissages Exponentiels dans \url{https://www.math.u-psud.fr/~goude/Materials/time_series/cours3_lissage_expo.pdf}, consultée le $30/09/2018$.}.\guillemotright.  Dans le travail de référence, le paramètre $\alpha$  vaut par défaut $0.01$.
	
	
	\item[confInterval] : ce paramètre indique le niveau de confiance de l'intervalle de confiance de la médiane calculée des RTTs différentiels. Précisément, cet intervalle de confiance calculé est de niveau de confiance égal à $ 1 - confInterval $.  L'intervalle de confiance d'une moyenne  est défini comme représentant les valeurs probables que peut prendre cette moyenne, si on accepte une marge d'erreur définie à l'avance. Il existe plusieurs méthodes pour calculer l'intervalle de confiance d'une proportion. Parmi les critères impliqués sur le choix de la méthode du calcul, on note le nombre total d'expériences.
	
	Au RTT différentiel courant et  au celui de référence d'un lien donné sont associés des intervalles de confiance.  le calcul des intervalles de confiance  est approché par le score de Wilson. Le score de wilson a été adopté car il donne des résultats même si la distribution pour laquelle l'intervalle de confiance est calculé est petite. Pour chaque lien et pour chaque période $d_k$,  deux intervalles de confiances sont calculés, pour ensuite évaluer le chevauchement entre ces deux intervalles. L'outil de détection utilise une marge d'erreur égale à  $ 0.05 $. Les détails du calcul des intervalles de confiances sont fournis dans la section[!].
\end{description}


\subsection{Processus de  détection des anomalies  : notation formelle}\label{steps-rtt-analysis}

Soient $ d_1 $, $  d_2 $, $d_k$, ..., $ d_n $ l'ensemble $D$ de $n$ périodes entre \textit{start} et \textit{end} avec $k \in [1,n]$. La différence entre le début de la période $ d_{k+1} $ et le début de la période $ d_k $ est égale à $timeWindow$ pour tout $k+1 \leq n $.  

Le processus de la détection des anomalies passe par plusieurs étapes. D'abord on  regroupe les traceroutes à analyser par période $d_k$ (étape $ 1 $). Ensuite, on prépare les traceroutes de toute  période $d_k$ en y appliquant un nombre d'opérations (étapes  $ 2 $ à $ 6 $) afin d'énumérer les liens possibles avec leurs RTTs différentiels. A la fin de la préparation des traceroutes de toutes les périodes, nous obtenons une liste de liens par période. Nous résumons ensuite ces liens en fusionnant les mêmes liens identifiés durant toutes les périodes tout en conservant la période pendant laquelle il a été identifié. Sur base des détails d'un lien donné,  nous identifions les anomalies dans leurs délais (étapes $ 7 $ à $9$). 

\subparagraph{Notations}
Chaque traceroute contient un ensemble de sauts, et chaque saut contient un ensemble de signaux. Chaque signal se caractérise par le routeur émettant ce signal et le RTT correspondant. 
Soit  $h_i$ le i\up{ème} saut d'un traceroute donné tel que $h_i =\{s_{i,j} |  j \in [1, S], i\in [1,H]  \}$, $S$ et $H$ sont des entiers. Soit $ s_{i,j} $  le j\up{ème} signal du i\up{ème} saut, il se caractérise par le routeur  source du signal $from_{i,j}$ et le RTT correspondant est $rtt_{i,j}$.

Les étapes $ 1$ à $9$ décrivant le processus de la détection sont les suivantes : 

\paragraph{1. Regroupement des traceroutes  par période $d_k$.} A chaque période $d_k$, on associe les traceroutes ayant été effectués durant $d_k$, noté $T_k$, parmi ceux disponibles à l'analyse. 
%, $k+1$ $\leq$ $n $ et  $d_k$ est exprimé en secondes (Unix Timestamp). Les étapes  ($ 2 $ à $ 6 $) concernent  les traceroutes de chaque $d_k$.  


\paragraph{2. Vérification de la validité de chaque traceroute.} 
Chaque traceroute $t_{k,m}$ de l'ensemble $T_k$, $m$  est le m\up{ème}  traceroute dans $T_k$,  est évalué en prenant en considération  les points suivants:
\begin{itemize}
	\item élimination des traceroutes échoués complètement;
	\item élimination des signaux contenant une adresse IP privée;
	\item élimination des signaux qui ne contiennent pas un RTT ou  qui contiennent un RTT négatif;
	\item élimination des signaux échoués.
\end{itemize}

Il existe deux sortes d'échecs dans un traceroute : échec complet et échec partiel. Dans le premier,   la sonde  ne réussit pas à atteindre la destination, dans ce cas, la liste des sauts est vide. Dans le deuxième cas, l'échec peut concerner un ou plusieurs saut, ou bien il peut concerner un, deux ou trois signaux d'un saut. A la fin de cette étape, nous obtenons une liste de traceroutes noté aussi $T_k$ pour la simplification. Car durant cette étape, des sauts ou des traceroutes peuvent être supprimés.

\paragraph{3. Calcul de la médiane des RTTs par saut.} 
Pour tout $ h_i $,  on calcule la médiane des RTTs ayant une même source $from_{i,j}$.  La médiane des RTTs d'un saut $h_i$ est  :

mediane\_rtt ($h_i$) =  $\{median(\{rtt_{i, j}  \})\}$
%\footnote{La notation $a.b$ désigne la valeur de l'attribut $b$ de l'objet $a$, ainsi $\{a.b\}$ est l'ensemble des $b$ obtenus à partir d'un ensemble d'éléments de type $a$ .}  
%pour tout  $rtt_{i, j} $ ayant  la même valeur du $ from_{i, j} $.

Autrement dit, le nouveau saut du traceroute est reconstruit en regroupant les signaux par adresse IP ($ from_{i, j} $) et ensuite en calculant la médiane de leurs RTTs ($rtt_{i,j}$). Par exemple, si on a un saut dont les trois signaux sont en provenance du même routeur, le nouveau saut est présenté par ce routeur avec un RTT obtenu en calculant la médiane des trois RTTs.


\paragraph{4. Inférence des liens topologiques par traceroute.} Un lien  est formé par chaque paire de routeurs consécutifs dans un traceroute. De manière générale, la Figure \ref{fig:link-inference_} illustre la constitution des liens possibles entre le saut $h_1$ et le saut $h_2$  dans un traceroute, issus de l'étape $3$. Soient  $R_{1,i}$, avec $i \in {1,2, ...,N}$,  l'ensemble de routeurs ($from_{1,i}$) distincts impliqués dans le saut $h_1$ et $R_{2,j}$, avec $j \in \{1,2, ..., M\}$, l'ensemble  de routeurs ($from_{2,i}$) distincts impliqués dans le saut $h_2$, avec $ N $ et $ M $ deux entiers. Les liens  construits sont ceux partant de tout $R_{2,j}$ vers tout $R_{1,i}$. A l'issue de cette étape, pour tout traceroute, on obtient la liste des liens possibles tout en reprenant des informations générales de la requête traceroute comme le temps de la requête (timestamp), etc.
\begin{figure}[H]
	\centering
	\captionsetup{justification=centering}
	\resizebox{0.4\textwidth}{!}{
		%\includegraphics[width=0.5\linewidth]{illustrations/link-inference}
		\input{illustrations/link-inference.tex}
	}
	\caption{Inférence des liens possibles entre les routeurs des deux sauts $h_{1}$ et $h_{2}$}
	\label{fig:link-inference_}
\end{figure}
\paragraph{5. Calcul des RTTs différentiels des liens.}  A cette étape, on calcule le RTT différentiel de chaque  lien, au sein d'un traceroute donné, en calculant la différence entre les RTTs des deux routeurs impliqués dans le  lien en question (équation \ref{eq:rttdifference}). En plus du RTT différentiel, on note aussi la sonde  ayant effectué la requête traceroute où le lien a été identifié. 

\paragraph{6. Fusion des informations d'un lien.} Un lien (IP1, IP2) peut être identifié plusieurs fois pendant une même période $d_k$. De plus, d'après le travail de référence,  le lien (IP2, IP1) est similaire au lien  (IP1, IP2). La fusion permet de construire une nouvelle distribution des RTTs différentiels caractérisant le lien (IP1, IP2) qui reprend les RTTs différentiels du lien (IP1, IP2) ainsi que ceux du lien (IP2, IP1). Dans le travail de référence, la similarité de deux liens  implique que les RTTs différentiels qui caractérisent un lien (IP2, IP1) caractérisent aussi le lien (IP1, IP2), d'où la fusion effectuée.


A la fin de l'étape 6, tous les traceroutes sont préparés. A présent, l'objectif est d'identifier les dates pendant lesquelles des anomalies ont été détectées. Pour ce faire, l'idée du travail de référence est de conserver, pour un lien donné, une référence du RTT différentiel médian.  Cette référence est d'abord comparée avec la médiane courante des RTTs différentiels,  puis,  mise à jour au fur et à mesure   tout au long de la période de l'analyse. A cette médiane, un intervalle de confiance est associé. Ainsi, l'intervalle de confiance fait partie aussi de la référence du lien. 


\paragraph{7. Calcul de la médiane des RTTs différentiels et  de l'intervalle de confiance courant.} Pour un lien donné, on calcule la médiane des RTTs différentiels d'une $d_k$, ensuite on calcule les deux bornes de l'intervalle de confiance  courant de cette médiane pour ce $d_k$.  



\paragraph{8. Mise à jour de la médiane et de l'intervalle  de confiance de  référence du lien analysé.} La médiane des RTTs différentiels de référence ainsi que l'intervalle de confiance de référence sont mise à jour tant que la période déclenchant la détection des anomalies n'est pas atteinte.  La mise à jour de la référence : médiane et les bornes de l'intervalle de confiance se base sur la moyenne mobile exponentielle. Cette méthode prend en compte les valeurs antérieures ainsi que celles récentes en étant dirigée par le paramètre \textit{confInterval} décrit dans la section \ref{par:parametre-de-lanalyse}.


\paragraph{9. Comparaison des intervalles de confiance.} 

La comparaison de l'état courant du lien avec celui de référence est effectuée en analysant le chevauchement d'intervalles de confiance  courant et de référence. Le délai d'un lien est jugé normal si son intervalle de confiance courant est inclus dans l'intervalle de confiance de référence. C'est le cas $1$ dans la Figure 	\ref{fig:intervals-comparaison},  \textit{referenceLow} et \textit{referenceHight} sont les bornes de l'intervalle de confiance de référence.  \textit{currentLow} et \textit{currentHight} sont les bornes de l'intervalle de confiance courant.
D'après le travail de référence, on distingue quatre cas possibles  illustrés dans la Figure 	\ref{fig:intervals-comparaison}:

\textbf{Cas 1 :} le délai du lien est normal.

\textbf{Cas 2 :} le délai du lien est anormal.

\textbf{Cas 3 :} le délai du lien est anormal.

\textbf{Cas 4 :} le délai du lien est anormal.

Dans le cas où le délai est jugé anormal, on introduit ce qu'on appelle la \textit{déviation}. Cette métrique caractérise l'anomalie détectée. Elle est calculée différemment dans le cas où le délai est anormal.

\begin{figure}[h]
	\centering
	\captionsetup{justification=centering}
	\resizebox{\textwidth}{!}{
		\input{illustrations/intervals-comparaison.tex}
	}
	\caption{La comparaison des deux intervalles de confiance : courant et référence }
	\label{fig:intervals-comparaison}
\end{figure}

%Ces étapes sont reprises dans  la Figure \ref{fig:process-rttanalysis_tex}. [!]


\subsection{Processus de détection des anomalies :  notation entrées et sorties} \label{processus-de-detection}
La détection des anomalies dans les délais des liens peut être organisée en deux phases: la préparation de données et la détection des alarmes.
\paragraph{Phase I : préparation de données.}

\begin{itemize}
	\item \textbf{findAllBins (I.1)} : nous cherchons la liste des périodes ({\color{gray}[bin]}) entre  {\color{gray}start} et  {\color{gray}end}. La durée de chaque {\color{gray}bin} vaut  {\color{gray}timeWindow}.
	\item \textbf{findTraceroutesByBin (I.2)} : pour toute période  ({\color{gray}bin}), nous récupérons les traceroutes
	capturés durant cette dernière. Le nombre de traceroutes associés à chaque {\color{gray}bin} dépend
	des traceroutes disponibles à l'analyse  ({\color{gray}[traceroute]}).
	\item \textbf{removeInvalidTraceroutes (I.3)} : certains traceroutes ne réussissent pas à atteindre la destination prévue, dans ce cas, ces traceroutes sont ignorés. De même, les sauts ayant des RTTs invalides
	sont aussi ignorés.
	\item \textbf{aggregateRttsByHop (I.4)} : étant donné que chaque saut  ({\color{gray}hop}) est décrit par plus d'un RTT, nous calculons la médiane de ces RTTs  ({\color{gray}rttAgg}), et ce par source de signal.
	\item \textbf{linkInference (I.5)} : chaque deux sauts consécutifs d'un traceroute forment un lien. Pour
	tout traceroute d'un  {\color{gray}bin} donné, nous déduisons les liens possibles, ensuite, nous caractérisons tout lien  {\color{gray}(ip1, ip2)} avec son RTT différentiel  ({\color{gray}rttDiff}).
	\item \textbf{sortLinks (I.6)}: nous ordonnons les couples d'adresses IP  {\color{gray}(ip1, ip2)} de chaque lien suivant l'ordre alphanumérique. 
	%Par exemple, 
	\item \textbf{mergeLinks (I.7)} : nous fusionnons les liens avec leurs caractéristiques. En résultat, les
	liens $ (ip1, ip2) $ et $ (ip2, ip1) $ sont fusionnés et sont représentés par le lien $ (ip1, ip2) $ si $ (ip1, ip2) $ $ < $ $ (ip2, ip1) $. $<$ désigne l'ordre alphanumérique.
	\item \textbf{resumeData (1.8)} : jusqu'à cette étape, les liens sont organisés par période ({\color{gray}bin}). A travers \textit{resumeData}, nous réorganisons chaque lien de toutes les périodes de sorte que chaque RTT différentiel soit associé à la période correspondante; la période pendant laquelle il a été identifié. C'est pourquoi les deux listes  {\color{gray}[rttDiff]} et  {\color{gray}[bin]} ont la même longueur.
	
	%Vu qu'un lien peut être identifié durant plusieurs périodes, nous résumons un lien en fusionnant leurs
	%RTTs différentiels. Toutefois, chaque RTT différentiel doit garder le  {\color{gray}bin} pendant lequel il a été identifié, ainsi 
	
	
	
\end{itemize}

\paragraph{ Phase II : détection des alarmes.}

A la fin de la phase I, nous avons tous les liens identifiés avec leurs
RTTs différentiels. 

\begin{itemize}
	
	\item \textbf{findAllBins (II.1)} : nous générons les mêmes périodes  ({\color{gray}[bin]}) que celles générées à
	l'étape (I.1).
	\item \textbf{ findRTTDiffByBin (II.2)} : nous reprenons les périodes générées dans l'ordre chronologique et
	pour chaque période nous cherchons les RTTs différentiels correspondants. Soit  {\color{gray}dist} l'ensemble des RTTs différentiels correspondants à la période courante.
	Seules les périodes ayant enregistré au moins  quatre RTTs différentiels qui  seront considérées.
	\item \textbf{ wilsonScoreProcess (II.3)} : le calcul de l'intervalle de confiance à partir du score de Wilson nécessite d'avoir le nombre total des expériences, le nombre d'expérience réussies et  le risque d'erreur. Nous calculons les deux valeurs du score de Wilson suivant les étapes suivantes :
	
	\begin{enumerate}
		\item Soit $n$ la taille de la distribution, nous calculons le score de Wilson et cela donne le couple de valeurs ($ low $, $ hight $);
		\item nous multiplions $ low $ et $ hight $ par  $n$, ainsi nous avons ($ lo $, $ hi $)=  ($ n*low $, $ n*hight $);
		\item nous récupérons la partie entière du  $ lo $ et $ hi $ et  nous obtenons
		
		($l$, $h$) = ($ int $($ lo $), $ int $($ hi $))\footnote{La fonction $  int() $ est utilisée pour avoir la partie entière d'un nombre réel.};
		\item  nous trions  {\color{gray}{dist}}  et nous parcourons cette dernière pour trouver les RTTs différentiels  se trouvant au rang $  l $ et $ h $ dans {\color{gray}dist}, respectivement sont $ rttDiffL $, $ rttDiffH $. Ainsi :
		
		$ rttDiffL  = dist[l]$  et $ rttDiffH = dist[h]$, avec $l$, $h$ $\in$ $[0,n[$. 
		
	\end{enumerate}
	
	
	\item \textbf{updateCurrentLinkState (II.4)} :  {\color{gray}current}  est l'objet encapsulant  l'état courant du lien à une période donnée, il a
	les éléments suivants:
	
	\begin{itemize}[label=$\square$]
		\item le RTT différentiel médian\footnote{\textit{median(list)} calcule la valeur médiane de la liste \textit{list}. } ({\color{gray}median}),
		{\color{gray}currentMedian} = median(dist) 
		
		\item  la borne inférieure de l'intervalle de confiance ({\color{gray}ciLow}),
		
		{\color{gray}currentCiLow} = {\color{gray}median} --  $ rttDiffL $
		
		\item   la borne supérieure de l'intervalle de confiance ({\color{gray}ciHight}),
		
		{\color{gray}currentCiHight} =  $ rttDiffH$ --  {\color{gray}median}
		
	\end{itemize}
	
	\item \textbf{ updateReferenceLinkState (II.5)} :  {\color{gray}reference}  est l'objet décrivant l'état de référence du lien à une période donnée. Il reprend les mêmes éléments que  l'objet {\color{gray}current}, à savoir, {\color{gray}median}, {\color{gray}ciLow} et {\color{gray}ciHight}. Ainsi, l'état référence est décrit par la médiane du RTT différentiel ({\color{gray}referenceMedian}), la borne inférieure de l'intervalle de confiance de référence ({\color{gray}referenceCiLow}) et enfin la borne supérieure de l'intervalle de confiance de référence ({\color{gray}referenceCiHight}).
	
	L'état courant décrit un lien à une période donnée, alors que l'état référence décrit l'état d'un lien à une période donnée en prenant en compte aussi les périodes qui précédent la période courante. La mise à jour de {\color{gray}reference}  est réalisée selon trois cas :
	
	\begin{enumerate}
		\item \underline{Cas $1$}: tant que nous n'avons pas construit une référence assez représentable de l'état du lien,  nous mettons à jour la référence ({\color{gray}reference}) comme suit: 
		\begin{align}
		referenceMedian &= median(dist)\\
		referenceCiLow &= rttDiffL\\
		referenceCiHight& = rttDiffH
		\end{align}
		\item \underline{Cas $2$} : une fois nous atteignons le nombre nécessaire de  mise à jour de la référence assurant sa représentativité, nous mettons à jour l'état référence en remplaçant, pour chaque période, la médiane par \textit{ aggr\_median}, la borne inférieure  par  \textit{aggr\_ciLow} et la borne sépérieure par \textit{aggr\_ciHigh}.
		\begin{itemize}
			
			\item  soit \textit{aggr\_median} la médiane de tous les RTTs différentiels médians de référence calculés pour toutes les périodes précédentes. 
			
			\item 	soit \textit{aggr\_ciLow} la médiane de     toutes les bornes inférieures calculées pendant les périodes précédentes.
			
			\item 	soit \textit{aggr\_ciHigh} la médiane de     toutes les bornes inférieures calculées pendant les périodes précédentes.
			
		\end{itemize}
		
		
		\item \underline{Cas $3$} : une fois la référence est assez représentable, nous mettons à jour cette dernière comme suit \footnote{Nous précisons que $ var[-1] $ dénote la dernière valeur que $ var $  avait. }:
\begin{align*}
referenceMedian &=  0.99*referenceMedian[-1]+0.01*currentMedian\\
referenceCiLow &=	 0.99*referenceLow[-1]+0.01*rttDiffL\\
referenceCiHight &=  0.99*referenceHight[-1]+0.01*rttDiffH
\end{align*}
		
		
		
		
	\end{enumerate}
	\item \textbf{ alarmsDetection (II.6) }:   la détection des anomalies est déclenchée à partir du cas $3$. Si une anomalie est détectée, nous mettons à jour la liste des alarmes  {\color{gray}(alarmsValues)} avec le RTT différentiel médian (currentMedian) ainsi que la
	liste des dates  {\color{gray}(alarmsDates)} qui correspondent à ces anomalies. Les anomalies sont détectées en évaluant le chevauchement entre l'intervalle de confiance courant et celui de référence. La période courante présente une anomalie si la condition suivante est vraie\footnote{Nous notons par [-1] l'élément précédent d'une mesure. Par exemple, currentMedian[-1] est la médiane des RTTs différentiels de la période qui précède la période courante.}:
	\begin{lstlisting}[language=json,firstnumber=1, caption={Conditions de présence d'une anomalie pour un lien},
	basicstyle =\footnotesize]
	currentMedian[-1]-currentCiLow[-1] > referenceHi[-1] or
	currentMedian[-1]+currentCiHigh[-1] < referenceCiLow[-1]) and
	np.abs(currentMedian[-1]-reference[-1])>1
	\end{lstlisting}
	
	
	
\end{itemize}

\paragraph{ Illustrations des deux phases de détection}~
La Figure  \ref{fig:step-preparing-data} reprend les étapes de la phase I. Chaque étape est définie par ses entrées et
ses sorties ainsi que son objectif et
la Figure \ref{fig:step-detection-anomalies} illustre aussi les principales étapes  de la phase II.
\newpage

\begin{figure}[H]
	\centering
	\captionsetup{justification=centering}
	\resizebox{!}{\textheight}{
		\input{illustrations/step-preparing-data.tex}
	}
	\caption{Phase I : préparation de données }
	\label{fig:step-preparing-data}
\end{figure}

\begin{figure}[H]
	\centering
	\captionsetup{justification=centering}
	\resizebox{\textwidth}{\textheight}{
		\input{illustrations/step-detection-anomalies.tex}
	}
	\caption{Phase II : détection des alarmes }
	\label{fig:step-detection-anomalies}
\end{figure}




\subsection{Exemple illustratif des étapes de la détections des alarmes}

\paragraph{Description de  l'échantillon} :

L'échantillon des traceroutes qui va nous permettre d'illustrer l'algorithme de la détection des alarmes est définie comme suit :

\begin{itemize}
	\item le nombre total de traceroutes est de $25$;
	\item le premier traceroute a été capturé à $1514769800$\footnote{Équivalent à GMT: Monday, January 1, 2018 1:23:20 suivant \url{https://www.epochconverter.com/}, consultée le $04/04/2019$.};
	\item le dernier traceroute a été capturé à $1514787809$\footnote{Équivalent à GMT: Monday, January 1, 2018 6:23:29 suivant \url{https://www.epochconverter.com/}, consultée le $04/04/2019$.};
	\item la durée d'une période est $1$ heure ($3600$);
	\item les débuts des périodes entre $ 1514769800 $ et $ 1514789809 $ sont  $ 1514769800 $, $ 1514773400 $, $ 1514777000 $, $ 1514780600 $, $ 1514784200 $, $ 1514787800 $;
	%\item la liste des traceroutes analysés est disponible sur[!].
\end{itemize} 



%\begin{landscape}

\begin{table}[H]
	\centering
	%\resizebox{\textwidth}{!}{
	\begin{tabular}{c|c}
		\textbf{étape} &  \textbf{résultats}	\\ \hline
		(I.1) &   $ 1514769800 $, $ 1514773400 $, $ 1514777000 $,
		
		$ 1514780600 $, $ 1514784200 $, $ 1514787800 $\\ \hline
		(I.2)& 
		\begin{tabular}{ccc}
			\textbf{id}&	\textbf{période}&\textbf{nombre de traceroutes} \\ \hline
			1&	[1514769800, 1514769800+3600] & 5\\ \hline
			2&	[1514773400, 1514773400+3600] & 4\\ \hline
			3&	[1514777000, 1514777000+3600] & 4\\ \hline
			4&	[1514780600, 1514780600+3600] &4 \\ \hline
			5&	[1514784200, 1514784200+3600] &4 \\ \hline
			6&	[1514787800, 1514787800+3600] & 4 \\ \hline
		\end{tabular}\\ \hline
	\end{tabular}
	%}
\end{table}

Une fois les traceroutes sont groupés par période, nous parcourons chaque traceroute afin d'éliminer ceux invalides (étape  I.3). 
Ensuite, nous agrégeons chaque saut par source de signal en calculant leur médiane. Nous donnons un exemple d'un traceroute qui illustre cette agrégation (voir les Listings \ref{beforemedianagg} et \ref{aftermedianagg}). Le même traitement est appliqué sur les autres traceroutes. 

\begin{lstlisting}[language=json,firstnumber=1, caption={Les sauts du traceroute T7 (sans agrégation)}, basicstyle=\footnotesize, label=beforemedianagg]
hop_id : 1, hops : [(from : 89.105.200.57, rtt : 1.955,  x : None),(from : 89.105.200.57, rtt : 1.7, x : None),(from : 89.105.200.57, rtt : 1.709,  x : None)]
hop_id : 2, hops : [(from : 185.147.12.31, rtt : 8.543,  x : None),(from : 185.147.12.31, rtt : 4.103, x : None),(from : 185.147.12.31, rtt : 4.41, x : None)]
hop_id : 3, hops : [(from : 185.147.12.19, rtt : 4.347,  x : None),(from : 185.147.12.19, rtt : 2.876, x : None),(from : 185.147.12.19, rtt : 3.143, x : None )]
\end{lstlisting}

\begin{lstlisting}[language=json,firstnumber=1, caption={Les sauts du traceroute T7 (après l'agrégation)}, basicstyle=\footnotesize, label=aftermedianagg]
hop_id : 1, hops : [(from : 89.105.200.57, rttAgg : 1.709)]
hop_id : 2, hops : [(from : 185.147.12.31, rttAgg : 4.41)] 
hop_id : 3, hops : [(from : 185.147.12.19, rttAgg : 3.143)]
\end{lstlisting}

L'inférence  des liens du traceroute T7 (étape I.5) fournit les liens suivants: 

\begin{lstlisting}[language=json,firstnumber=1, caption={Exemple des liens inférés du traceroute T7}, basicstyle = \footnotesize]
lien 1 : (link : (185.147.12.31, 89.105.200.57), rttDiff : 2.701)
lien 2 : (link : (185.147.12.19,185.147.12.31), rttDiff : -1.267)
\end{lstlisting}


A l'étape (I.6), nous ordonnons les adresses IP de chaque lien  comme c'est illustré dans le Listing \ref{sortLinks} avec la fonction \textit{sort()}. 

\begin{lstlisting}[language=json,firstnumber=1, caption={Illustration de l'ordre des liens}, basicstyle = \footnotesize, label=sortLinks]
sort(("185.147.12.31","89.105.200.57")) = ("185.147.12.31","89.105.200.57")
sort(("89.105.200.57","185.147.12.31"))= ("185.147.12.31","89.105.200.57")   
\end{lstlisting}

L'ordonnancement à l'étape  I.6 est une préparation à la fusion. Nous fusionnons les liens ayant impliqué les mêmes routeurs. Prenons les liens inférés à partir des $5$ traceroutes  comme c'est montré dans le Listing \ref{linksofsometraceroutes}.

\begin{lstlisting}[language=json,firstnumber=1, caption={Liste des liens possibles inférés via  les traceroutes T1, T2, T3, T4 et T5}, basicstyle = \footnotesize, label=linksofsometraceroutes]
T1 (link : (185.147.12.31,89.105.200.57), rttDiff : 2.463)
(link : (185.147.12.19,185.147.12.31), rttDiff : -1.029)

T2 (link : (185.147.12.31,89.105.200.57), rttDiff : 3.463) 
(link : (185.147.12.19,185.147.12.31), rttDiff : -2.029)

T3 (link : (185.147.12.31,89.105.200.57), rttDiff : 2.991) 
(link : (185.147.12.19,185.147.12.31), rttDiff : -1.557)

T4 (link : (185.147.12.31,89.105.200.57), rttDiff : 4.631) 
(link : (185.147.12.19,185.147.12.31), rttDiff : -3.197)

T5 (link : (89.105.200.57,185.147.12.31), rttDiff : -7.75) 
(link : (185.147.12.19,89.105.200.57), rttDiff : 3.803)
\end{lstlisting}

La fusion de ces liens nous donne les trois liens présentés dans le Listing \ref{morelinks}. Chaque lien est caractérisé par les sondes l'ayant capturé, leurs  RTTs Différentiels et la période dupliquée, pendant laquelle il a été identifié, en nombre de RTTs différentiels. 

\begin{lstlisting}[language=json,firstnumber=1, caption={Caractérisation des liens identifiés lors  de la période 1514769800 avec les traceroutes T1, T2, T3, T4 et T5}, basicstyle = \footnotesize, label =morelinks]
[(link :(185.147.12.19,89.105.200.57),
probes : [4247],
rttDiffs :[3.803],
bins :[1514769800]),

(link : (185.147.12.19,185.147.12.31),
probes : [4247, 4247, 4247, 4247],
rttDiffs :[-1.029, -2.029, -1.557, -3.197],
bins : [1514769800, 1514769800, 1514769800, 1514769800]),

(link : (185.147.12.31,89.105.200.57),
probes : [4247, 4247, 4247, 4247, 4247],
rttDiffs :[2.463, 3.463, 2.991, 4.631, -7.75],
bins : [1514769800, 1514769800, 1514769800, 1514769800, 1514769800]) ]
\end{lstlisting}

Après avoir analysé  toutes les périodes, nous résumons les liens en fusionnant les données relatives à toutes les périodes, c'est l'objectif de l'étape I.8.

\begin{lstlisting}[language=json,firstnumber=1, caption={Illustration de l'ordre des liens}, basicstyle = \footnotesize]
[(link   : (185.147.12.19,89.105.200.57), 
probes : (4247), 
rttDiffs : (3.803), 
bins : (1514769800)),  

link : (185.147.12.19,185.147.12.31), 
probes : (4247, 4247, 4247, 4247, 4247, 4247, 4247, 4247, 4247, 4247, 4247, 4247, 4247, 4247, 4247, 4247, 4247, 4247, 4247, 4247, 4247, 4247, 4247, 4247), 
rttDiffs : (-1.267, -2.407, -1.49, -3.029, -1060.029, -1045.029, -1098.029, -1080.029, -680.029, -845.029, -998.029, -800.029, -1.029, -2.029, -1.557, -3.197, -1.277, -2.017, -1.257, -2.968, -0.96, -1.967, -0.987, -3.201), 
bins : (1514787800, 1514787800, 1514787800, 1514787800, 1514784200, 1514784200, 1514784200, 1514784200, 1514780600, 1514780600, 1514780600, 1514780600, 1514769800, 1514769800, 1514769800, 1514769800, 1514773400, 1514773400, 1514773400, 1514773400, 1514777000, 1514777000, 1514777000, 1514777000)),  

link : (185.147.12.31,89.105.200.57),
probes : (4247, 4247, 4247, 4247, 4247, 4247, 4247, 4247, 4247, 4247, 4247, 4247, 4247, 4247, 4247, 4247, 4247, 4247, 4247, 4247, 4247, 4247, 4247, 4247, 4247),
rttDiffs : (2.701, 3.841, 2.924, 4.463, 1061.463, 1046.463, 1099.463, 1081.463, 681.463, 846.463, 999.463, 801.463, 2.463, 3.463, 2.991, 4.631, -7.75, 2.711, 3.451, 2.691, 4.402, 2.394, 3.401, 2.421, 4.635),
bins : (1514787800, 1514787800, 1514787800, 1514787800, 1514784200, 1514784200, 1514784200, 1514784200, 1514780600, 1514780600, 1514780600, 1514780600, 1514769800, 1514769800, 1514769800, 1514769800, 1514769800, 1514773400, 1514773400, 1514773400, 1514773400, 1514777000, 1514777000, 1514777000, 1514777000))]
\end{lstlisting}


A la fin de l'étape I.8, nous disposons de tous les liens possibles caractérisés avec leurs RTTs différentiels. Ainsi, nous pouvons entamer la phase II du processus de la détection.

Dans un premier temps, nous générons les mêmes  périodes générées à  l'étape I.1. Pour chaque période,  nous récupérons les RTTs différentiels identifiés durant celle-ci, et nous obtenons {\color{gray} dist}, cette dernière représente l'ensemble des RTTs différentiels de la période courante, c'est l'objectif de l'étape II.2.

Dans notre exemple,  et pour la clarté de ce dernier, une référence est assez représentable après avoir calculé 3 intervalles de confiances.  

Les tableaux suivants reprennent les différentes itérations permettant d'analyser notre ensemble de traceroutes ($25$). Chaque tableau illustre les résultats de l'analyse d'une période, dans l'ordre chronologique de ces périodes.
\newpage
%\begin{landscape}
\begin{table}[H]
	\centering
	
	%	\resizebox{24.7cm}{!}{
	\begin{tabularx}{\linewidth}{|l|X| }
		\hline
		\textbf{itération} & 1	\\ \hline
		\textbf{bin} & $1514769800$ \\ \hline
		\textbf{lien} & $(185.147.12.31, 89.105.200.57)$  \\ \hline
		\textbf{dist}& [-7.75, 2.463, 2.991, 3.463, 4.631]	\\ \hline
		\textbf{(low, hight)}& (0.11762077423264793, 0.7692757187239873) 	\\ \hline
		\textbf{(lo, hi)}&(0.5881038711632396, 3.8463785936199364)  \\ \hline
		\textbf{(l, h)} & (0, 3) 	\\ \hline
		\textbf{rttDiffL}& dist[0] = -7.75	\\ \hline
		\textbf{rttDiffH}& dist[3]= 3.463	\\ \hline
		\textbf{currentMedian}& 2.991	\\ \hline
		\textbf{currentCiLow}&  2.991 - (-7.75) = 10.741 	\\ \hline
		\textbf{currentCiHi}& 3.463 - 2.991 =  0.472	\\ \hline
		\textbf{cas 1? 2? 3?}& cas 1 (aucun intervalle de confiance calculé)  \\ \hline
		\textbf{referenceMedian}& 2.991	\\ \hline
		\textbf{referenceCiLow}& -7.75	\\ \hline
		\textbf{referenceCiHi}&3.463	\\ \hline
		\textbf{détection des alarmes ?}& non (car cas 3 pas  encore atteint)	\\ \hline
		\textbf{alarmesDates}& []	\\ \hline
		\textbf{alarmesValues}& []	\\ \hline
		
		
	\end{tabularx}
	%	}
\end{table}


\begin{table}[H]
	\centering
	
	%	\resizebox{24.7cm}{!}{
	\begin{tabularx}{\linewidth}{|l|X| }
		\hline
		\textbf{itération} & 2	\\ \hline
		\textbf{bin} & $1514773400$ \\ \hline
		\textbf{lien} & $(185.147.12.31, 89.105.200.57)$  \\ \hline
		\textbf{dist}& [2.691, 2.711, 3.451, 4.402]	\\ \hline
		\textbf{(low, hight)}& (0.15003898915214947, 0.8499610108478506) 	\\ \hline
		\textbf{(lo, hi)}&(0.6001559566085979, 3.3998440433914023)  \\ \hline
		\textbf{(l, h)} & (0, 3) 	\\ \hline
		\textbf{rttDiffL}& dist[0] = 2.691	\\ \hline
		\textbf{rttDiffH}& dist[3]= 4.402	\\ \hline
		\textbf{currentMedian}& 3.081	\\ \hline
		\textbf{currentCiLow}&  0.39 	\\ \hline
		\textbf{currentCiHi}& 1.321	\\ \hline
		\textbf{	cas 1? 2? 3?}& cas 1 (1 intervalle de confiance calculé)  \\ \hline
		\textbf{referenceMedian}& 3.081	\\ \hline
		\textbf{referenceCiLow}& 2.691	\\ \hline
		\textbf{referenceCiHi}&4.402	\\ \hline
		\textbf{détection des alarmes} ?& non (car cas 3 pas  encore atteint)	\\ \hline
		\textbf{alarmesDates}& []	\\ \hline
		\textbf{alarmesValues}& []	\\ \hline
		
		
	\end{tabularx}
	%	}
\end{table}

\begin{table}[H]
	\centering
	
	%	\resizebox{24.7cm}{!}{
	\begin{tabularx}{\linewidth}{|l|X| }
		\hline
		\textbf{itération} & 3	\\ \hline
		\textbf{bin} & $1514777000$ \\ \hline
		\textbf{lien} & $(185.147.12.31, 89.105.200.57)$  \\ \hline
		\textbf{dist}& [2.394, 2.421, 3.401, 4.635]	\\ \hline
		\textbf{(low, hight)}& (0.15003898915214947, 0.8499610108478506) 	\\ \hline
		\textbf{(lo, hi)}&(0.6001559566085979, 3.3998440433914023)  \\ \hline
		\textbf{(l, h)} & (0, 3) 	\\ \hline
		\textbf{rttDiffL}& dist[0] = 2.394	\\ \hline
		\textbf{rttDiffH}& dist[3]= 4.635	\\ \hline
		\textbf{currentMedian}& 2.9109999999999996	\\ \hline
		\textbf{currentCiLow}& 0.5169999999999996 	\\ \hline
		\textbf{currentCiHi}& 1.7240000000000004	\\ \hline
		\textbf{cas 1? 2? 3?}& cas 1 (2 intervalle de confiance calculé)  \\ \hline
		\textbf{referenceMedian}& 2.9109999999999996	\\ \hline
		\textbf{referenceCiLow}& 2.394	\\ \hline
		\textbf{referenceCiHi}& 4.635	\\ \hline
		\textbf{détection des alarmes ?}& (car cas 3 pas  encore atteint)	\\ \hline
		\textbf{alarmesDates}& []	\\ \hline
		\textbf{alarmesValues}& []	\\ \hline
		
		
	\end{tabularx}
	%	}
\end{table}



\begin{table}[H]
	\centering
	
	%	\resizebox{24.7cm}{!}{
	\begin{tabularx}{\linewidth}{|l|X| }
		\hline
		\textbf{itération} & 4	\\ \hline
		\textbf{bin} & $1514780600$ \\ \hline
		\textbf{lien} & $(185.147.12.31, 89.105.200.57)$  \\ \hline
		\textbf{dist}& [681.463, 801.463, 846.463, 999.463]	\\ \hline
		\textbf{(low, hight)}& (0.15003898915214947, 0.8499610108478506) 	\\ \hline
		\textbf{(lo, hi)}&(0.6001559566085979, 3.3998440433914023)  \\ \hline
		\textbf{(l, h)} & (0, 3) 	\\ \hline
		\textbf{rttDiffL}& dist[0] = 681.463	\\ \hline
		\textbf{rttDiffH}& dist[3]= 999.463	\\ \hline
		\textbf{currentMedian}& 823.963	\\ \hline
		\textbf{currentCiLow}& 142.5 	\\ \hline
		\textbf{currentCiHi}& 175.5	\\ \hline
		\textbf{cas 1? 2? 3?}& cas 2 (3 intervalle de confiance calculé)  \\ \hline
		\textbf{referenceMedian}& 2.991 (car median([2.991, 3.081, 2.9109999999999996])= 2.991)	\\ \hline
		\textbf{referenceCiLow}& 2.394 (car median ([-7.75, 2.691, 2.394])= 2.394)	\\ \hline
		\textbf{referenceCiHi}& 4.402 (car median([3.463, 4.402, 4.635])=4.402)	\\ \hline
		\textbf{détection des alarmes ?}& non (car cas 3 pas  encore atteint)	\\ \hline
		\textbf{alarmesDates}& []	\\ \hline
		\textbf{alarmesValues}& []	\\ \hline
		
	\end{tabularx}
	%	}
\end{table}







\begin{table}[H]
	\centering
	
	%	\resizebox{24.7cm}{!}{
	\begin{tabularx}{\linewidth}{|l|X| }
		\hline
		\textbf{itération} & 5	\\ \hline
		\textbf{bin} & $1514784200$ \\ \hline
		\textbf{lien} & $(185.147.12.31, 89.105.200.57)$  \\ \hline
		\textbf{dist}& [1046.463, 1061.463, 1081.463, 1099.463]	\\ \hline
		\textbf{(low, hight)}& (0.15003898915214947, 0.8499610108478506) 	\\ \hline
		\textbf{(lo, hi)}&(0.6001559566085979, 3.3998440433914023)  \\ \hline
		\textbf{(l, h)} & (0, 3) 	\\ \hline
		\textbf{rttDiffL}& dist[0] = 1046.463	\\ \hline
		\textbf{rttDiffH}& dist[3]= 1099.463	\\ \hline
		\textbf{currentMedian}& 1071.463	\\ \hline
		\textbf{currentCiLow}& 25.0 	\\ \hline
		\textbf{currentCiHi}& 28.0	\\ \hline
		\textbf{cas 1? 2? 3?}& cas 3 (car la référence est assez représentable )  \\ \hline
		\textbf{referenceMedian}& 13.67572 (car $ 0.99×2.991 + 0.01×1071.463 = 13.67572 $ ) 	\\ \hline
		\textbf{referenceCiLow}& 12.83469  (car $ 0.99×2.394+ 0.01×1046.463 = 12.83469  $)	\\ \hline
		\textbf{referenceCiHi}& 15.352609999999999 (car $ 0.99×4.402 + 0.01×1099.463 = 15.35261 $)	\\ \hline
		\textbf{détection des alarmes ?}& oui (car : cas 3)	\\ \hline
		\textbf{alarmesDates}& [1514784200]	\\ \hline
		\textbf{alarmesValues}& [1071.463]	\\ \hline
		
	\end{tabularx}
	%	}
\end{table}



\begin{table}[H]
	\centering
	
	%	\resizebox{24.7cm}{!}{
	\begin{tabularx}{\linewidth}{|l|X| }
		\hline
		\textbf{itération} & 6	\\ \hline
		\textbf{bin} & $1514787800$ \\ \hline
		\textbf{lien} & $(185.147.12.31, 89.105.200.57)$  \\ \hline
		\textbf{dist}& [2.701, 2.924, 3.841, 4.463]	\\ \hline
		\textbf{(low, hight)}& (0.15003898915214947, 0.8499610108478506) 	\\ \hline
		\textbf{(lo, hi)}&(0.6001559566085979, 3.3998440433914023)  \\ \hline
		\textbf{(l, h)} & (0, 3) 	\\ \hline
		\textbf{rttDiffL}& dist[0] = 2.701	\\ \hline
		\textbf{rttDiffH}& dist[3]= 4.463	\\ \hline
		\textbf{currentMedian}&  3.3825000000000003	\\ \hline
		\textbf{currentCiLow}& 0.6815000000000003 	\\ \hline
		\textbf{currentCiHi}& 15.243713899999998	\\ \hline
		\textbf{cas 1? 2? 3?}& cas 3 (car la référence est assez représentable)  \\ \hline
		\textbf{referenceMedian}& 13.5727878 	\\ \hline
		\textbf{referenceCiLow}&  12.7333531	\\ \hline
		\textbf{referenceCiHi}& 15.352609999999999 	\\ \hline
		\textbf{détection des alarmes ?}& oui (car : cas 3)	\\ \hline
		\textbf{alarmesDates}& [1514784200, 1514787800]	\\ \hline
		\textbf{alarmesValues}& [1071.463, 3.3825000000000003]	\\ \hline
	\end{tabularx}
	%	}
\end{table}
